# description   : No description available
# depends       : extracmakemodules breezeicons docbookxml docbookxslnons libcanberra libgcrypt libical libxslt lmdb qca libqrencode plasmawaylandprotocols pyyaml sharedmimeinfo uri wget aspell avahi modemmanager networkmanager polkitqt vulkanloader zxingcpp kdeframeworks6preinstallationconfiguration doxygen doxypypy doxyqml requests

name=building kde frameworks 6.17.0 (kf6)
version=
release=1
source=""

options="!checksum"

build() {
    cd $name-$version
    
    url=https://download.kde.org/stable/frameworks/6.17/
    wget -r -nH -nd -A '*.xz' -np $url
cat > $PKGframeworks-6.17.0.md5 << "EOF"
EOF
    as_root()
    {
    if   [ $EUID = 0 ];        then $*
    elif [ -x /usr/bin/sudo ]; then sudo $*
    else                            su -c \\"$*\\"
    fi
}
export -f as_root
bash -e
while read -r line; do
# Get the file name, ignoring comments and blank lines
if $(echo $line | grep -E -q '^ *$|^#' ); then continue; fi
file=$(echo $line | cut -d" " -f2)
pkg=$(echo $file|sed 's|^.*/||')          # Remove directory
packagedir=$(echo $pkg|sed 's|\.tar.*||') # Package directory
name=$(echo $pkg|sed 's|-6.*$||') # Isolate package name
tar -xf $file
pushd $packagedir
# kapidox is a python module
case $name in
kapidox)
pip3 wheel -w dist --no-build-isolation --no-deps --no-cache-dir $PWD
as_root pip3 install --no-index --find-links dist --no-user kapidox
popd
rm -rf $packagedir
continue
;;
esac
mkdir build
cd    build
cmake -D CMAKE_INSTALL_PREFIX=$KF6_PREFIX \
-D CMAKE_INSTALL_LIBEXECDIR=libexec \
-D CMAKE_PREFIX_PATH=$QT6DIR        \
-D CMAKE_SKIP_INSTALL_RPATH=ON      \
-D CMAKE_BUILD_TYPE=Release         \
-D BUILD_TESTING=OFF                \
-D BUILD_PYTHON_BINDINGS=OFF        \
-W no-dev ..
make
as_root make install
popd
as_root rm -rf $packagedir
as_root /sbin/ldconfig
done < frameworks-6.17.0.md5
exit
mv -v /opt/kf6 /opt/kf6.old                         
install -v -dm755           $KF6_PREFIX/{etc,share} 
ln -sfv /etc/dbus-1         $KF6_PREFIX/etc         
ln -sfv /usr/share/dbus-1   $KF6_PREFIX/share       
ln -sfv /usr/share/polkit-1 $KF6_PREFIX/share
rm -rf $KF6_PREFIX/lib/systemd
mv -v /opt/kf6 /opt/kf6-6.17.0
ln -sfvn kf6-6.17.0 /opt/kf6
}
