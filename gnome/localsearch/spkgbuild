# description   : The Localsearch package contains a filesystem indexer as well as a metadata extractor
# depends       : gexiv2 gstpluginsbase tinysparql exempi giflib ffmpeg icu libexif libgxps libseccomp poppler upower

name=localsearch
version=3.9.0    
release=1
source="https://download.gnome.org/sources/localsearch/3.9/localsearch-$version.tar.xz
https://www.linuxfromscratch.org/patches/blfs/svn/localsearch-$version-libxml2_2_14-1.patch"

options="!checksum"

build() {
    cd $name-$version
    
    sed -i s/120/
    / tests/functional-tests/meson.build
    patch -Np1 -i ../localsearch-$version-libxml2_2_14-1.patch
    mkdir build 
    cd    build 
    meson setup --prefix=/usr                  \
    --buildtype=release            \
    -D systemd_user_services=false \
    -D man=false                   \
    ..                             
    ninja
    dbus-run-session env LC_ALL=C.UTF-8 TRACKER_TESTS_AWAIT_TIMEOUT=
    \
    DESTDIR=$PKG ninja test 
    rm -rf ~/tracker-tests
    rm -fv /etc/xdg/autostart/tracker-miner-fs-3.desktop                           
    rm -fv /usr/lib/systemd/user/tracker-miner-fs-3.service                        
    rm -fv /usr/lib/systemd/user/tracker-miner-fs-control-3.service                
    rm -fv /usr/share/dbus-1/services/org.freedesktop.Tracker3.Miner.Files.service 
    rm -fv /usr/share/dbus-1/services/org.freedesktop.Tracker3.Writeback.service   
    rm -fv /usr/share/dbus-1/services/org.freedesktop.Tracker3.Miner.Files.Control.service
    DESTDIR=$PKG ninja install
}
