# description   : MuPDF is a lightweight PDF and XPS viewer
# depends       : xorg libraries freeglut harfbuzz libjpegturbo openjpeg curl agraphical environment

name=mupdf
version=1.26.4    
release=1
source="https://www.mupdf.com/downloads/archive/mupdf-$version-source.tar.gz"

options="!checksum"

build() {
    cd $name-$version
    
cat > $PKGuser.make << EOF 
    USE_SYSTEM_FREETYPE := yes
    USE_SYSTEM_HARFBUZZ := yes
    USE_SYSTEM_JBIG2DEC := no
    USE_SYSTEM_JPEGXR := no # not used without HAVE_JPEGXR
    USE_SYSTEM_LCMS2 := no # lcms2mt is strongly preferred
    USE_SYSTEM_LIBJPEG := yes
    USE_SYSTEM_MUJS := no # build needs source anyway
    USE_SYSTEM_OPENJPEG := yes
    USE_SYSTEM_ZLIB := yes
    USE_SYSTEM_GLUT := yes
    USE_SYSTEM_CURL := yes
    USE_SYSTEM_GUMBO := no
EOF
    export XCFLAGS=-fPIC                      
    make DESTDIR=$PKG build=release shared=yes verbose=yes 
    unset XCFLAGS
    make DESTDIR=$PKG prefix=/usr                        \
    shared=yes                         \
    docdir=/usr/share/doc/mupdf-$version \
    install                            
    ln -sfv libmupdf.so.26.4 /usr/lib/libmupdf.so.26 
    ln -sfv libmupdf.so.26   /usr/lib/libmupdf.so    
    chmod 755 /usr/lib/libmupdf.so.26.4              
    ln -sfv mupdf-x11 /usr/bin/mupdf
}
