# description   : Xindy is an index processor that can be used to generate book-like indexes for arbitrary document-preparation systems
# depends       : clisp texlive

name=xindy
version=2.5.1    
release=1
source="https://tug.ctan.org/support/xindy/base/xindy-$version.tar.gz
https://www.linuxfromscratch.org/patches/blfs/svn/xindy-$version-upstream_fixes-2.patch"

options="!checksum"

build() {
    cd $name-$version
    
    export TEXARCH=$(uname -m | sed -e 's/i.86/i386/' -e 's/$/-linux/') 
    sed -i "s/ grep -v '^;'/ awk NF/" make-rules/inputenc/Makefile.in 
    sed -i 's%\(indexentry\)%\1\\%' make-rules/inputenc/make-inp-rules.pl 
    patch -Np1 -i ../xindy-$version-upstream_fixes-2.patch 
    ./configure --prefix=$TEXLIVE_PREFIX              \
    --bindir=$TEXLIVE_PREFIX/bin/$TEXARCH \
    --datarootdir=$TEXLIVE_PREFIX         \
    --includedir=/usr/include             \
    --libdir=$TEXLIVE_PREFIX/texmf-dist   \
    --mandir=$TEXLIVE_PREFIX/texmf-dist/doc/man 
    make DESTDIR=$PKG LC_ALL=POSIX
    make DESTDIR=$PKG install
}
