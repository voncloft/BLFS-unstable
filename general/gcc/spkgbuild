# description   : The GCC package contains the GNU Compiler Collection
# depends       : 

name=gcc
version=15.1.0    
release=1
source="https://ftp.gnu.org/gnu/gcc/gcc-$version/gcc-$version.tar.xz"

options="!checksum"

build() {
    cd $name-$version
    
    case $(uname -m) in
    x86_64)
    sed -i.orig '/m64=/s/lib64/lib/' gcc/config/i386/t-linux64
    ;;
    esac
    mkdir build               
    cd    build               
    ../configure              \
    --prefix=/usr         \
    --disable-multilib    \
    --with-system-zlib    \
    --enable-default-pie  \
    --enable-default-ssp  \
    --enable-host-pie     \
    --disable-fixincludes \
    --enable-languages=c,c++,fortran,go,objc,obj-c++,m2 
    make
    make DESTDIR=$PKG -k check
    ../contrib/test_summary
    make DESTDIR=$PKG install 
    mkdir -pv /usr/share/gdb/auto-load/usr/lib              
    mv -v /usr/lib/*gdb.py /usr/share/gdb/auto-load/usr/lib 
    chown -v -R root:root \
    /usr/lib/gcc/*linux-gnu/$version/include{,-fixed}     
    ln -sfv ../../libexec/gcc/$(gcc -dumpmachine)/$version/liblto_plugin.so \
    /usr/lib/bfd-plugins/
}
