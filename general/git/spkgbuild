# description   : Git is a free and open source, distributed version control system designed to handle everything from small to very large projects with speed and efficiency
# depends       : curl

name=git
version=2.50.1    
release=1
source="https://www.kernel.org/pub/software/scm/git/git-$version.tar.xz
https://www.kernel.org/pub/software/scm/git/git-manpages-$version.tar.xz
https://www.kernel.org/pub/software/scm/git/git-htmldocs-$version.tar.xz"

options="!checksum"

build() {
    cd $name-$version
    
    ./configure --prefix=/usr \
    --with-gitconfig=/etc/gitconfig \
    --with-python=python3 
    make
    make DESTDIR=$PKG html
    make DESTDIR=$PKG man
    make DESTDIR=$PKG perllibdir=/usr/lib/perl5/5.42/site_perl install
    make DESTDIR=$PKG install-man
    make DESTDIR=$PKG htmldir=/usr/share/doc/git-$version install-html
    tar -xf ../git-manpages-$version.tar.xz \
    -C /usr/share/man --no-same-owner --no-overwrite-dir
    mkdir -vp   /usr/share/doc/git-$version 
    tar   -xf   ../git-htmldocs-$version.tar.xz \
    -C    /usr/share/doc/git-$version --no-same-owner --no-overwrite-dir 
    find        /usr/share/doc/git-$version -type d -exec chmod 755 {} \; 
    find        /usr/share/doc/git-$version -type f -exec chmod 644 {} \;
    mkdir -vp /usr/share/doc/git-$version/man-pages/{html,text}         
    mv        /usr/share/doc/git-$version/{git*.adoc,man-pages/text}     
    mv        /usr/share/doc/git-$version/{git*.,index.,man-pages/}html 
    mkdir -vp /usr/share/doc/git-$version/technical/{html,text}         
    mv        /usr/share/doc/git-$version/technical/{*.adoc,text}        
    mv        /usr/share/doc/git-$version/technical/{*.,}html           
    mkdir -vp /usr/share/doc/git-$version/howto/{html,text}             
    mv        /usr/share/doc/git-$version/howto/{*.adoc,text}            
    mv        /usr/share/doc/git-$version/howto/{*.,}html               
    sed -i '/^<a href=/s|howto/|html/|' /usr/share/doc/git-$version/howto-index.html 
    sed -i '/^\* link:/s|howto/|html/|' /usr/share/doc/git-$version/howto-index.adoc
}
