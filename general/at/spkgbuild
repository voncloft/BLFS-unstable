# description   : The at package provides delayed job execution and batch processing
# depends       : mta

name=at
version=3.2.5    
release=1
source="https://anduin.linuxfromscratch.org/BLFS/at/at_$version.orig.tar.gz"

options="!checksum"

build() {
    cd $name-$version
    
    ./configure --with-daemon_username=atd        \
    --with-daemon_groupname=atd       \
    --with-jobdir=/var/spool/atjobs   \
    --with-atspool=/var/spool/atspool \
    SENDMAIL=/usr/sbin/sendmail       
    make DESTDIR=$PKG -j1
    groupadd -g 17 atd                                                  
    useradd -d /dev/null -c "atd daemon" -g atd -s /bin/false -u 17 atd
    make DESTDIR=$PKG install docdir=/usr/share/doc/at-$version \
    atdocdir=/usr/share/doc/at-$version
cat > $PKG/etc/pam.d/atd << "EOF"
    # Begin /etc/pam.d/atd
    auth     required pam_unix.so
    account  required pam_unix.so
    password required pam_unix.so
    session  required pam_unix.so
    # End /etc/pam.d/atd
EOF
    make DESTDIR=$PKG install-atd
}
