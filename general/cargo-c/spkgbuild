# description   : The cargo-c package creates a cargo subcommand to build and install C-ABI compatible dynamic and static libraries
# depends       : rustc libssh2 sqlite

name=cargo-c
version=0.10.14    
release=1
source="https://github.com/lu-zero/cargo-c/archive/v$version/cargo-c-$version.tar.gz"

options="!checksum"

build() {
    cd $name-$version
    
    curl -fLO https://github.com/lu-zero/cargo-c/releases/download/v$version/Cargo.lock
    [ ! -e /usr/include/libssh2.h ] || export LIBSSH2_SYS_USE_PKG_CONFIG=1    
    [ ! -e /usr/include/sqlite3.h ] || export LIBSQLITE3_SYS_USE_PKG_CONFIG=1 
    cargo build --release
    unset LIB{SSH2,SQLITE3}_SYS_USE_PKG_CONFIG
    install -vm755 target/release/cargo-{capi,cbuild,cinstall,ctest} /usr/bin/
}
