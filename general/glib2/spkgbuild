# description   : The GLib package contains low-level libraries useful for providing data structure handling for C, portability wrappers and interfaces for runtime functionality such as an event loop, threads, dynamic loading and an object system
# depends       : docutils libxslt pcre2 sharedmimeinfo desktopfileutils

name=glib
version=2.84.4    
release=1
source="https://download.gnome.org/sources/glib/2.84/glib-$version.tar.xz
https://download.gnome.org/sources/gobject-introspection/1.84/gobject-introspection-1.84.0.tar.xz
https://www.linuxfromscratch.org/patches/blfs/svn/glib-skip_warnings-1.patch"

options="!checksum"

build() {
    cd $name-$version
    
    patch -Np1 -i ../glib-skip_warnings-1.patch
    mkdir build 
    cd    build 
    meson setup ..                  \
    --prefix=/usr             \
    --buildtype=release       \
    -D introspection=disabled \
    -D glib_debug=disabled    \
    -D man-pages=enabled      \
    -D sysprof=disabled       
    ninja
    tar xf ../../gobject-introspection-1.84.0.tar.xz 
    meson setup gobject-introspection-1.84.0 gi-build \
    --prefix=/usr --buildtype=release     
    DESTDIR=$PKG ninja -C gi-build
    meson configure -D introspection=enabled 
    ninja
    sed "/docs_dir =/s|$| / 'glib-' + meson.project_version()|" \
    -i ../docs/reference/meson.build                        
    meson configure -D documentation=true                       
    ninja
    if [ -e /usr/include/glib-2.0 ]; then
    rm -rf /usr/include/glib-2.0.old 
    mv -vf /usr/include/glib-2.0{,.old}
    fi
    DESTDIR=$PKG ninja install
    DESTDIR=$PKG ninja -C gi-build install
    DESTDIR=$PKG ninja install
}
