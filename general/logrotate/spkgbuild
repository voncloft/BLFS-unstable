# description   : The logrotate package allows automatic rotation, compression, removal, and mailing of log files
# depends       : popt fcron

name=logrotate
version=3.22.0    
release=1
source="https://github.com/logrotate/logrotate/releases/download/$version/logrotate-$version.tar.xz"

options="!checksum"

build() {
    cd $name-$version
    
    ./configure --prefix=/usr 
    make
cat > $PKG/etc/logrotate.d/sys.log << EOF
EOF
    chmod -v 0644 /etc/logrotate.d/sys.log
cat > $PKG/etc/logrotate.d/example.log << EOF
EOF
    chmod -v 0644 /etc/logrotate.d/example.log
    make DESTDIR=$PKG install
cat > $PKG/etc/logrotate.conf << EOF
    # Begin /etc/logrotate.conf
    # Rotate log files weekly
    weekly
    # Don't mail logs to anybody
    nomail
    # If the log file is empty, it will not be rotated
    notifempty
    # Number of backups that will be kept
    # This will keep the 2 newest backups only
    rotate 2
    # Create new empty files after rotating old ones
    # This will create empty log files, with owner
    # set to root, group set to sys, and permissions 664
    create 0664 root sys
    # Compress the backups with gzip
    compress
    # No packages own lastlog or wtmp -- rotate them here
    /var/log/wtmp {
    monthly
    create 0664 root utmp
    rotate 1
}
/var/log/lastlog {
monthly
rotate 1
}
# Some packages drop log rotation info in this directory
# so we include any file in it.
include /etc/logrotate.d
# End /etc/logrotate.conf
EOF
chmod -v 0644 /etc/logrotate.conf
mkdir -p /etc/logrotate.d
cat > $PKG/etc/cron.daily/logrotate.sh << "EOF" 
#!/bin/bash
/usr/sbin/logrotate /etc/logrotate.conf
EOF
chmod 754 /etc/cron.daily/logrotate.sh
}
