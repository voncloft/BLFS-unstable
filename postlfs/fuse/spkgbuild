# description   : FUSE (Filesystem in Userspace) is a simple interface for userspace programs to export a virtual filesystem to the Linux kernel
# depends       : 

name=fuse
version=3.17.3    
release=1
source="https://github.com/libfuse/libfuse/releases/download/fuse-$version/fuse-$version.tar.gz"

options="!checksum"

build() {
    cd $name-$version
    
    sed -i '/^udev/,$ s/^/#/' util/meson.build 
    mkdir build 
    cd    build 
    meson setup --prefix=/usr --buildtype=release .. 
    ninja
    pushd .. 
    doxygen doc/Doxyfile 
    popd
    python3 -m venv --system-site-packages testenv 
    source testenv/bin/activate                    
    pip3 install looseversion                      
    python3 -m pytest
    deactivate
    DESTDIR=$PKG ninja install                  
    chmod u+s /usr/bin/fusermount3 
    cd ..                          
    cp -Rv doc/html -T /usr/share/doc/fuse-$version 
    install -v -m644   doc/{README.NFS,kernel.txt} \
    /usr/share/doc/fuse-$version
cat > $PKG/etc/fuse.conf << "EOF"
    # Set the maximum number of FUSE mounts allowed to non-root users.
    # The default is 1000.
    #
    #mount_max = 1000
    # Allow non-root users to specify the 'allow_other' or 'allow_root'
    # mount options.
    #
    #user_allow_other
EOF
}
