# description   : The Xorg libraries provide library routines that are used within all X Window applications
# depends       : fontconfig libxcb

name=xorg libraries
version=
release=1
source=""

options="!checksum"

build() {
    cd $name-$version
    
cat > $PKGlib-7.md5 << "EOF"
EOF
    mkdir lib 
    cd lib 
    grep -v '^#' ../lib-7.md5 | awk '{print $2}' | wget -i- -c \
    -B https://www.x.org/pub/individual/lib/ 
    md5sum -c ../lib-7.md5
    as_root()
    {
    if   [ $EUID = 0 ];        then $*
    elif [ -x /usr/bin/sudo ]; then sudo $*
    else                            su -c \\"$*\\"
    fi
}
export -f as_root
grep -A9 summary *make_check.log
bash -e
for package in $(grep -v '^#' ../lib-7.md5 | awk '{print $2}')
do
packagedir=${package%.tar.?z*}
echo "Building $packagedir"
tar -xf $package
pushd $packagedir
docdir="--docdir=$XORG_PREFIX/share/doc/$packagedir"
case $packagedir in
libXfont2-[0-9]* )
./configure $XORG_CONFIG $docdir --disable-devel-docs
;;
libXt-[0-9]* )
./configure $XORG_CONFIG $docdir \
--with-appdefaultdir=/etc/X11/app-defaults
;;
libXpm-[0-9]* )
./configure $XORG_CONFIG $docdir --disable-open-zfile
;;
libpciaccess* )
mkdir build
cd    build
meson setup --prefix=$XORG_PREFIX --buildtype=release ..
ninja
#ninja test
as_root ninja install
popd     # $packagedir
continue # for loop
;;
* )
./configure $XORG_CONFIG $docdir
;;
esac
make
#make check 2>1 | tee ../$packagedir-make_check.log
as_root make install
popd
rm -rf $packagedir
as_root /sbin/ldconfig
done
exit
ln -sv $XORG_PREFIX/lib/X11 /usr/lib/X11 
ln -sv $XORG_PREFIX/include/X11 /usr/include/X11
}
