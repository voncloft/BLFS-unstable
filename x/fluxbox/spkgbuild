# description   : The Fluxbox package contains a window manager
# depends       : agraphical environment

name=fluxbox
version=1.3.7    
release=1
source="https://downloads.sourceforge.net/fluxbox/fluxbox-$version.tar.xz"

options="!checksum"

build() {
    cd $name-$version
    
    sed -i '/text_prop.value > 0/s/>/!=/' util/fluxbox-remote.cc
    ./configure --prefix=/usr 
    make
    echo startfluxbox > ~/.xinitrc
    mkdir -v ~/.fluxbox 
    cp -v /usr/share/fluxbox/init ~/.fluxbox/init 
    cp -v /usr/share/fluxbox/keys ~/.fluxbox/keys
    cd ~/.fluxbox 
    fluxbox-generate_menu
    cp -v /usr/share/fluxbox/menu ~/.fluxbox/menu
    cp -r /usr/share/fluxbox/styles/<theme> ~/.fluxbox/theme 
    sed -i 's,\(session.styleFile:\).*,\1 ~/.fluxbox/theme,' ~/.fluxbox/init 
    [ -f ~/.fluxbox/theme ] 
    echo "background.pixmap: </path/to/nice/image.ext>" >> ~/.fluxbox/theme ||
    [ -d ~/.fluxbox/theme ] 
    echo "background.pixmap: </path/to/nice/image.ext>" >> ~/.fluxbox/theme/theme.cfg
    make DESTDIR=$PKG install
    mkdir -pv /usr/share/xsessions 
cat > $PKG/usr/share/xsessions/fluxbox.desktop << "EOF"
    [Desktop Entry]
    Encoding=UTF-8
    Name=Fluxbox
    Comment=This session logs you into Fluxbox
    Exec=startfluxbox
    Type=Application
EOF
}
