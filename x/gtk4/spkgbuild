# description   : The GTK 4 package contains libraries used for creating graphical user interfaces for applications
# depends       : gdkpixbuf graphene isocodes libepoxy libxkbcommon pango pygobject waylandprotocols adwaitaicontheme gstpluginsbad glslcfromshaderc gstpluginsgood libvpx hicoloricontheme librsvg vulkanloader glib

name=gtk
version=4.18.6    
release=1
source="https://download.gnome.org/sources/gtk/4.18/gtk-$version.tar.xz"

options="!checksum"

build() {
    cd $name-$version
    
    sed -e '939 s/= { 0, }//'                                       \
    -e '940 a memset (transform, 0, sizeof(GtkCssTransform));' \
    -i gtk/gtkcsstransformvalue.c
    mkdir build 
    cd    build 
    meson setup --prefix=/usr            \
    --buildtype=release      \
    -D broadway-backend=true \
    -D introspection=enabled \
    -D vulkan=enabled        \
    .. 
    ninja
    sed "s@'doc'@ / 'gtk-$version'@" -i ../docs/reference/meson.build 
    meson configure -D documentation=true                            
    ninja
    env -u{GALLIUM_DRIVER,MESA_LOADER_DRIVER_OVERRIDE}          \
    LIBGL_ALWAYS_SOFTWARE=1 VK_LOADER_DRIVERS_SELECT='lvp*' \
    dbus-run-session meson test --setup x11                 \
    --no-suite={headless,needs-udmabuf}
    mkdir -pv ~/.config/gtk-4.0
cat > $PKG~/.config/gtk-4.0/settings.ini << "EOF"
EOF
    DESTDIR=$PKG ninja install
}
