# description   : The Xorg Server is the core of the X Window system
# depends       : libxcvt pixman xorg fonts xkeyboardconfig libepoxy libtirpc xorglibinputdriver

name=xorg-server
version=21.1.18    
release=1
source="https://www.x.org/pub/individual/xserver/xorg-server-$version.tar.xz
https://www.linuxfromscratch.org/patches/blfs/svn/xorg-server-$version-tearfree_backport-1.patch"

options="!checksum"

build() {
    cd $name-$version
    
    patch -Np1 -i ../xorg-server-$version-tearfree_backport-1.patch
    mkdir build 
    cd    build 
    meson setup ..               \
    --prefix=$XORG_PREFIX  \
    --localstatedir=/var   \
    -D glamor=true         \
    -D systemd_logind=true \
    -D xkb_output_dir=/var/lib/xkb 
    ninja
    DESTDIR=$PKG ninja install 
    mkdir -pv /etc/X11/xorg.conf.d 
    install -v -d -m1777 /tmp/.{ICE,X11}-unix 
cat >> /etc/sysconfig/createfiles << "EOF"
    /tmp/.ICE-unix dir 1777 root root
    /tmp/.X11-unix dir 1777 root root
EOF
}
